---
- name: ğŸ“Š æœåŠ¡ç›‘æ§æ£€æŸ¥
  hosts: all
  become: yes
  
  vars:
    services_to_check:
      - ssh
      - docker
      - nginx
      - postgresql
    
  tasks:
    - name: ğŸ” æ£€æŸ¥å…³é”®æœåŠ¡çŠ¶æ€
      systemd:
        name: "{{ item }}"
      register: service_status
      loop: "{{ services_to_check }}"
      ignore_errors: yes
      
    - name: ğŸ“‹ æ˜¾ç¤ºæœåŠ¡çŠ¶æ€æŠ¥å‘Š
      debug:
        msg: |
          æœåŠ¡: {{ item.item }}
          çŠ¶æ€: {{ item.status.ActiveState | default('æœªå®‰è£…') }}
          è¿è¡ŒçŠ¶æ€: {{ item.status.SubState | default('N/A') }}
      loop: "{{ service_status.results }}"
      when: item.status is defined
    
    - name: ğŸš¨ æ£€æŸ¥å¤±è´¥çš„æœåŠ¡
      debug:
        msg: "âš ï¸ æœåŠ¡ {{ item.item }} çŠ¶æ€å¼‚å¸¸!"
      loop: "{{ service_status.results }}"
      when: item.status is defined and item.status.ActiveState != "active"
    
    - name: ğŸ’¾ æ£€æŸ¥ç£ç›˜ç©ºé—´è­¦å‘Š
      shell: df -h | awk '$5 > 80 {print $0}'
      register: disk_warning
      
    - name: ğŸš¨ ç£ç›˜ç©ºé—´è­¦å‘Š
      debug:
        msg: |
          âš ï¸ ä»¥ä¸‹åˆ†åŒºç£ç›˜ä½¿ç”¨ç‡è¶…è¿‡80%:
          {{ disk_warning.stdout }}
      when: disk_warning.stdout != ""
    
    - name: ğŸŒ¡ï¸ æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½
      shell: uptime | awk -F'load average:' '{print $2}'
      register: load_avg
      
    - name: ğŸ“Š æ˜¾ç¤ºç³»ç»Ÿè´Ÿè½½
      debug:
        msg: "å½“å‰ç³»ç»Ÿè´Ÿè½½: {{ load_avg.stdout.strip() }}"
