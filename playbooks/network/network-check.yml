---
- name: ğŸŒ ç½‘ç»œè¿æ¥è¯Šæ–­
  hosts: all
  become: no
  
  vars:
    test_hosts:
      - "8.8.8.8"
      - "114.114.114.114"
      - "baidu.com"
      - "github.com"
    test_ports:
      - { host: "localhost", port: 22 }
      - { host: "localhost", port: 80 }
      - { host: "localhost", port: 443 }
  
  tasks:
    - name: ğŸ“ Ping æµ‹è¯•
      ping:
        data: "{{ item }}"
      loop: "{{ test_hosts }}"
      register: ping_results
      ignore_errors: yes
      
    - name: ğŸ“Š æ˜¾ç¤º Ping æµ‹è¯•ç»“æœ
      debug:
        msg: |
          ç›®æ ‡: {{ item.item }}
          çŠ¶æ€: {{ 'âœ… å¯è¾¾' if item.ping is defined else 'âŒ ä¸å¯è¾¾' }}
      loop: "{{ ping_results.results }}"
    
    - name: ğŸ”Œ ç«¯å£è¿é€šæ€§æµ‹è¯•
      wait_for:
        host: "{{ item.host }}"
        port: "{{ item.port }}"
        timeout: 5
      loop: "{{ test_ports }}"
      register: port_results
      ignore_errors: yes
      
    - name: ğŸšª æ˜¾ç¤ºç«¯å£æµ‹è¯•ç»“æœ
      debug:
        msg: |
          åœ°å€: {{ item.item.host }}:{{ item.item.port }}
          çŠ¶æ€: {{ 'âœ… å¼€æ”¾' if not item.failed else 'âŒ å…³é—­' }}
      loop: "{{ port_results.results }}"
    
    - name: ğŸ” æ˜¾ç¤ºç½‘ç»œæ¥å£ä¿¡æ¯
      shell: ip route show default
      register: default_route
      
    - name: ğŸ›£ï¸ æ˜¾ç¤ºé»˜è®¤è·¯ç”±
      debug:
        msg: "é»˜è®¤è·¯ç”±: {{ default_route.stdout }}"
    
    - name: ğŸ“¡ DNS è§£ææµ‹è¯•
      shell: nslookup {{ item }}
      loop: ["baidu.com", "github.com"]
      register: dns_results
      ignore_errors: yes
      
    - name: ğŸ” æ˜¾ç¤º DNS è§£æç»“æœ
      debug:
        msg: |
          åŸŸå: {{ item.item }}
          è§£æ: {{ 'âœ… æˆåŠŸ' if not item.failed else 'âŒ å¤±è´¥' }}
      loop: "{{ dns_results.results }}"
