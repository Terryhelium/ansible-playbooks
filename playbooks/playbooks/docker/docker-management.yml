---
- name: ğŸ³ Docker å®¹å™¨ç®¡ç†
  hosts: docker_hosts
  become: yes
  
  vars:
    container_action: "status"  # status, start, stop, restart
    container_name: "all"       # å®¹å™¨åç§°æˆ– "all"
  
  tasks:
    - name: ğŸ” æ£€æŸ¥ Docker æœåŠ¡çŠ¶æ€
      systemd:
        name: docker
      register: docker_service
      
    - name: ğŸ“Š æ˜¾ç¤º Docker æœåŠ¡çŠ¶æ€
      debug:
        msg: "Docker æœåŠ¡çŠ¶æ€: {{ docker_service.status.ActiveState }}"
    
    - name: ğŸ“‹ åˆ—å‡ºæ‰€æœ‰å®¹å™¨
      shell: docker ps -a --format "table {{.Names}}\t{{.Status}}\t{{.Image}}"
      register: container_list
      when: container_action == "status"
      
    - name: ğŸ³ æ˜¾ç¤ºå®¹å™¨åˆ—è¡¨
      debug:
        var: container_list.stdout_lines
      when: container_action == "status"
    
    - name: ğŸš€ å¯åŠ¨æŒ‡å®šå®¹å™¨
      docker_container:
        name: "{{ container_name }}"
        state: started
      when: container_action == "start" and container_name != "all"
      
    - name: â¹ï¸ åœæ­¢æŒ‡å®šå®¹å™¨
      docker_container:
        name: "{{ container_name }}"
        state: stopped
      when: container_action == "stop" and container_name != "all"
    
    - name: ğŸ”„ é‡å¯æŒ‡å®šå®¹å™¨
      docker_container:
        name: "{{ container_name }}"
        state: started
        restart: yes
      when: container_action == "restart" and container_name != "all"
    
    - name: ğŸ§¹ æ¸…ç†æœªä½¿ç”¨çš„ Docker èµ„æº
      shell: docker system prune -f
      register: cleanup_result
      when: container_action == "cleanup"
      
    - name: âœ¨ æ˜¾ç¤ºæ¸…ç†ç»“æœ
      debug:
        var: cleanup_result.stdout
      when: container_action == "cleanup"
