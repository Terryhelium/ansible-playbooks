---
- name: âš¡ å¿«é€Ÿç³»ç»Ÿæµ‹è¯•
  hosts: localhost
  connection: local
  become: no
  
  tasks:
    - name: ğŸ¯ æµ‹è¯•å¼€å§‹
      debug:
        msg: |
          ğŸš€ å¼€å§‹æ‰§è¡Œå¿«é€Ÿç³»ç»Ÿæµ‹è¯•
          æ—¶é—´: {{ ansible_date_time.iso8601 }}
          æ‰§è¡Œä¸»æœº: {{ ansible_hostname }}
    
    - name: ğŸ“ åˆ›å»ºæµ‹è¯•ç›®å½•
      file:
        path: /tmp/semaphore-test
        state: directory
        mode: '0755'
    
    - name: ğŸ“ åˆ›å»ºæµ‹è¯•æ–‡ä»¶
      copy:
        content: |
          Semaphore æµ‹è¯•æ–‡ä»¶
          åˆ›å»ºæ—¶é—´: {{ ansible_date_time.iso8601 }}
          ä¸»æœºå: {{ ansible_hostname }}
          ç”¨æˆ·: {{ ansible_user_id }}
        dest: /tmp/semaphore-test/test-{{ ansible_date_time.epoch }}.txt
        mode: '0644'
      register: test_file
    
    - name: âœ… éªŒè¯æ–‡ä»¶åˆ›å»º
      stat:
        path: "{{ test_file.dest }}"
      register: file_check
      
    - name: ğŸ“‹ æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
      debug:
        msg: |
          æ–‡ä»¶è·¯å¾„: {{ test_file.dest }}
          æ–‡ä»¶å¤§å°: {{ file_check.stat.size }} å­—èŠ‚
          åˆ›å»ºæ—¶é—´: {{ file_check.stat.ctime }}
          æƒé™: {{ file_check.stat.mode }}
    
    - name: ğŸ§ª æ‰§è¡Œç³»ç»Ÿå‘½ä»¤æµ‹è¯•
      shell: |
        echo "=== ç³»ç»Ÿä¿¡æ¯ ==="
        whoami
        pwd
        date
        echo "=== æµ‹è¯•å®Œæˆ ==="
      register: cmd_output
      
    - name: ğŸ“Š æ˜¾ç¤ºå‘½ä»¤è¾“å‡º
      debug:
        var: cmd_output.stdout_lines
    
    - name: ğŸ‰ æµ‹è¯•å®Œæˆ
      debug:
        msg: |
          âœ… å¿«é€Ÿæµ‹è¯•æ‰§è¡Œå®Œæˆï¼
          ğŸ“ æµ‹è¯•æ–‡ä»¶: {{ test_file.dest }}
          ğŸ• æ‰§è¡Œæ—¶é—´: {{ ansible_date_time.iso8601 }}
          
          ğŸ’¡ æç¤º: å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹æµ‹è¯•æ–‡ä»¶:
          cat {{ test_file.dest }}
